# VoxAI - 项目需求文档

## 项目概述

VoxAI是一款集成AI聊天功能的Android变声器应用，旨在为用户提供有趣的语音变换体验，同时支持与AI进行智能对话。

## 核心功能需求

### 1. 变声器模块

#### 1.1 录音功能
- **需求描述**: 用户可以实时录制音频
- **技术实现**: 
  - 使用Android AudioRecord API进行音频采集
  - 采样率: 44.1kHz
  - 音频格式: PCM 16-bit
  - 单声道录音
  - 实时显示录音时长
- **用户交互**:
  - 点击麦克风按钮开始录音
  - 再次点击停止录音
  - 显示录音时长计时器
  - 录音过程中按钮变为红色

#### 1.2 音频处理与变声效果
- **需求描述**: 对录制的音频应用多种变声效果
- **变声效果列表**:
  1. **原声** - 不做任何处理
  2. **男声** - 降低音调(0.8x)，略微减慢速度(0.95x)
  3. **女声** - 提高音调(1.3x)，略微加快速度(1.05x)
  4. **儿童声** - 显著提高音调(1.5x)，加快速度(1.1x)
  5. **机器人** - 应用调制效果，产生机械感
  6. **怪物** - 大幅降低音调(0.6x)，减慢速度(0.9x)
  7. **外星人** - 显著提高音调(1.8x)，加快速度(1.15x)
  8. **低沉** - 降低音调(0.7x)，略微减慢速度(0.92x)
  9. **花栗鼠** - 大幅提高音调(1.6x)，明显加快速度(1.2x)

- **技术实现**:
  - 音调变换算法
  - 音速调整算法
  - 特殊效果处理(如机器人效果的调制)

#### 1.3 音频播放
- **需求描述**: 播放原始录音或变声后的音频
- **技术实现**:
  - 使用Android AudioTrack进行音频播放
  - 支持播放控制(播放/暂停/停止)
  - 显示播放状态
- **用户交互**:
  - 播放按钮切换播放/暂停状态
  - 播放过程中显示进度指示

#### 1.4 音频文件操作
- **需求描述**: 保存和分享变声后的音频
- **功能点**:
  - 保存音频到本地存储
  - 分享音频到其他应用
  - 导入本地音频文件进行变声处理
- **文件格式**: WAV或MP3

### 2. AI聊天模块

#### 2.1 文字对话
- **需求描述**: 用户可以通过文字与AI进行对话
- **技术实现**:
  - 集成OpenAI GPT-3.5 Turbo API
  - 支持上下文对话(保留最近10条消息)
  - 异步网络请求，不阻塞UI
- **用户交互**:
  - 输入框输入消息
  - 点击发送按钮发送消息
  - 消息以气泡形式展示
  - 用户消息显示在右侧(紫色)
  - AI消息显示在左侧(深灰色)
  - 显示消息时间戳

#### 2.2 对话历史
- **需求描述**: 保存和管理对话历史记录
- **技术实现**:
  - 使用Room数据库本地存储
  - 自动保存所有对话
  - 支持查询历史消息
- **用户交互**:
  - 进入聊天界面自动加载历史消息
  - 支持清空所有历史记录
  - 支持删除单条消息

#### 2.3 AI语音回复(高级功能)
- **需求描述**: AI的文字回复可以转换为语音
- **技术实现**:
  - 集成TTS(Text-to-Speech)引擎
  - 可选择使用Google TTS或其他TTS服务
  - 支持对AI语音应用变声效果
- **用户交互**:
  - 在设置中启用/禁用语音回复
  - 选择是否对AI语音应用变声效果
  - 点击消息可播放语音

#### 2.4 错误处理
- **需求描述**: 妥善处理网络错误和API错误
- **错误场景**:
  - 网络连接失败
  - API请求超时
  - API密钥无效
  - 请求频率限制
- **用户反馈**:
  - 显示友好的错误提示
  - 提供重试选项

### 3. 设置模块

#### 3.1 通用设置
- **主题设置**: 
  - 浅色模式
  - 深色模式
  - 跟随系统
- **语言设置**: 支持中文(初期)

#### 3.2 音频设置
- **音频质量**: 
  - 低(22.05kHz)
  - 中(44.1kHz) - 默认
  - 高(48kHz)
- **降噪**: 启用/禁用背景噪音抑制

#### 3.3 AI设置
- **AI模型选择**: 
  - GPT-3.5 Turbo(默认)
  - GPT-4(可选，需更高配额)
- **API密钥配置**: 允许用户输入自己的OpenAI API密钥
- **语音回复**: 启用/禁用TTS
- **变声AI回复**: 对AI语音应用变声效果

#### 3.4 关于信息
- 应用版本
- 开源许可证信息
- 反馈与支持渠道

### 4. 权限管理

#### 4.1 必需权限
- **RECORD_AUDIO**: 录音功能必需
- **READ_EXTERNAL_STORAGE**: 导入音频文件(Android 12及以下)
- **WRITE_EXTERNAL_STORAGE**: 保存音频文件(Android 12及以下)
- **READ_MEDIA_AUDIO**: 访问音频文件(Android 13+)
- **INTERNET**: AI聊天功能必需
- **ACCESS_NETWORK_STATE**: 检查网络状态

#### 4.2 权限请求流程
- 首次使用相关功能时请求权限
- 显示权限说明对话框
- 权限被拒绝时显示功能不可用提示
- 提供跳转到应用设置的选项

## 非功能性需求

### 1. 性能要求
- 应用启动时间 < 2秒
- 录音延迟 < 100ms
- 变声处理时间 < 1秒(对于30秒音频)
- UI响应时间 < 100ms
- AI回复延迟取决于网络和API响应时间

### 2. 兼容性要求
- **最低Android版本**: Android 7.0 (API 24)
- **目标Android版本**: Android 14 (API 34)
- **屏幕尺寸**: 支持手机和小平板(4.5"-10")
- **屏幕方向**: 主要支持竖屏，部分界面支持横屏

### 3. 安全性要求
- API密钥加密存储
- 本地数据库加密(可选)
- 不在日志中输出敏感信息
- 网络请求使用HTTPS

### 4. 可用性要求
- 界面简洁直观，易于理解
- 操作流程简单，学习成本低
- 提供清晰的错误提示和帮助信息
- 支持无障碍功能(TalkBack等)

### 5. 可维护性要求
- 代码遵循MVVM架构模式
- 使用Kotlin编写，遵循Kotlin代码规范
- 关键功能编写单元测试
- 使用依赖注入，便于测试和替换组件

## 技术架构

### 1. 架构模式
- **MVVM** (Model-View-ViewModel)
- **单向数据流**
- **Repository模式**用于数据层

### 2. 技术栈
- **开发语言**: Kotlin
- **UI框架**: Jetpack Compose
- **依赖注入**: Hilt
- **异步处理**: Kotlin Coroutines + Flow
- **网络请求**: Retrofit + OkHttp
- **本地数据库**: Room
- **音频处理**: Android AudioRecord/AudioTrack
- **导航**: Navigation Compose

### 3. 项目结构
```
com.voxai/
├── data/                    # 数据层
│   ├── local/              # 本地数据源
│   │   ├── entity/         # Room实体
│   │   ├── dao/            # Room DAO
│   │   └── VoxAIDatabase   # 数据库
│   ├── remote/             # 远程数据源
│   │   ├── dto/            # 网络数据传输对象
│   │   └── api/            # API服务接口
│   └── repository/         # 数据仓库实现
├── domain/                 # 业务逻辑层
│   ├── model/              # 领域模型
│   ├── repository/         # 仓库接口
│   └── usecase/            # 用例(可选)
├── presentation/           # 表现层
│   ├── theme/              # UI主题
│   ├── voicechanger/       # 变声器界面
│   ├── aichat/             # AI聊天界面
│   ├── settings/           # 设置界面
│   └── common/             # 通用UI组件
├── util/                   # 工具类
│   ├── audio/              # 音频处理工具
│   └── permission/         # 权限管理工具
└── di/                     # 依赖注入模块
```

## 开发里程碑

### Phase 1: 基础框架 (已完成)
- [x] 项目创建和配置
- [x] 依赖项配置
- [x] 基础架构搭建
- [x] UI主题和通用组件

### Phase 2: 变声器核心功能 (已完成)
- [x] 音频录制功能
- [x] 变声算法实现
- [x] 音频播放功能
- [x] 变声器UI实现

### Phase 3: AI聊天功能 (已完成)
- [x] OpenAI API集成
- [x] 聊天界面实现
- [x] 消息存储(Room数据库)
- [x] 对话历史管理

### Phase 4: 设置和完善 (已完成)
- [x] 设置界面
- [x] 权限管理
- [x] 主导航实现

### Phase 5: 优化和测试 (待进行)
- [ ] 性能优化
- [ ] 单元测试
- [ ] UI测试
- [ ] Bug修复

### Phase 6: 高级功能 (未来计划)
- [ ] TTS集成
- [ ] 音频文件导入/导出
- [ ] 更多变声效果
- [ ] 云端同步
- [ ] 社交分享

## 测试计划

### 1. 单元测试
- ViewModel逻辑测试
- Repository层测试
- 音频处理算法测试
- 工具类测试

### 2. 集成测试
- 数据库操作测试
- 网络请求测试
- 音频录制播放测试

### 3. UI测试
- 界面渲染测试
- 用户交互测试
- 导航流程测试

### 4. 手动测试
- 功能完整性测试
- 兼容性测试(不同设备、Android版本)
- 性能测试
- 用户体验测试

## 发布计划

### Alpha版本 (内部测试)
- 核心功能实现
- 基本稳定性保证
- 内部团队测试

### Beta版本 (公开测试)
- 功能完善
- 性能优化
- 邀请用户测试
- 收集反馈

### 正式版本 1.0
- 所有核心功能完成
- 经过充分测试
- 发布到应用商店

## 后续规划

### v1.1
- 音频文件导入导出
- 更多变声效果
- UI优化

### v1.2
- TTS集成
- 语音识别
- 实时变声

### v2.0
- 云端同步
- 用户账号系统
- 分享到社交媒体
- 音效市场

## 风险评估

### 技术风险
- **音频处理性能**: 某些低端设备可能处理较慢
  - 缓解措施: 优化算法，提供质量选项
- **API限制**: OpenAI API可能有请求频率限制
  - 缓解措施: 实现请求队列和重试机制

### 业务风险
- **用户隐私**: 录音数据的隐私保护
  - 缓解措施: 本地存储，明确隐私政策
- **成本控制**: AI API调用成本
  - 缓解措施: 允许用户使用自己的API密钥

## 联系信息

如有任何问题或建议，请联系：
- Email: support@voxai.app
- GitHub Issues: https://github.com/yourusername/VoxAI/issues
